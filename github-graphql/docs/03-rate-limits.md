# GraphQL API에 대한 속도 제한 및 쿼리 제한

## 개요

GitHub의 GraphQL API는 과도하거나 악의적인 호출로부터 서버를 보호하기 위해 제한 사항을 적용합니다.

## 기본 트래픽률 제한

각 쿼리에 포인트를 할당하고 특정 시간 내 사용 가능한 포인트를 제한합니다.

### 인증 방법별 제한

| 인증 방법 | 제한 |
|----------|------|
| 사용자 | 시간당 5,000포인트 (GitHub Enterprise Cloud 조직 소유 앱은 10,000포인트) |
| GitHub Enterprise Cloud 외 앱 설치 | 설치별 시간당 5,000포인트 (최대 12,500포인트) |
| GitHub Enterprise Cloud 조직 앱 | 설치별 시간당 10,000포인트 |
| OAuth 앱 | 시간당 5,000포인트 (조직 소유 시 10,000포인트) |
| GitHub Actions GITHUB_TOKEN | 리포지토리당 시간당 1,000포인트 |

### 상태 확인 헤더

| 헤더 | 설명 |
|------|------|
| `x-ratelimit-limit` | 시간당 최대 포인트 |
| `x-ratelimit-remaining` | 잔여 포인트 |
| `x-ratelimit-used` | 사용한 포인트 |
| `x-ratelimit-reset` | 재설정 시간 (UTC Epoch 초) |
| `x-ratelimit-resource` | 제한 리소스 (GraphQL은 항상 `graphql`) |

### 포인트 값 조회

```graphql
query {
  viewer {
    login
  }
  rateLimit {
    limit
    remaining
    used
    resetAt
  }
}
```

### 포인트 값 예측

1. 각 연결별 필요한 요청 수 합산 (`first`/`last` 한계 도달 가정)
2. 합계를 100으로 나누고 가장 가까운 정수로 반올림

**최소값**: 1포인트

## 보조 속도 제한

기본 제한 외에도 남용 방지를 위한 추가 제한 적용:

| 제한 항목 | 제한값 |
|----------|--------|
| 동시 요청 | 100개 이하 (REST/GraphQL 공유) |
| 분당 엔드포인트 요청 | REST는 900포인트, GraphQL은 2,000포인트 초과 불가 |
| CPU 시간 | 60초당 90초 초과 불가 (GraphQL은 60초 이하) |
| 콘텐츠 생성 | 분당 80개, 시간당 500개 이하 |

### 보조 제한 포인트 계산

| 요청 유형 | 포인트 |
|----------|--------|
| 변형 없는 GraphQL | 1 |
| 변형 있는 GraphQL | 5 |
| REST GET/HEAD/OPTIONS | 1 |
| REST POST/PATCH/PUT/DELETE | 5 |

## 제한 초과 시

**기본 제한 초과**:
- 응답 상태: 200 (오류 메시지 포함)
- `x-ratelimit-remaining`: 0
- 조치: `x-ratelimit-reset`까지 대기

**보조 제한 초과**:
- 응답 상태: 200 또는 403
- `retry-after` 헤더 있으면 해당 시간 대기
- 없으면 1분 이상 대기 후 재시도

계속 위반하면 통합이 금지될 수 있습니다.

## 제한 내 유지 방법

- 변경 요청 간 1초 이상 대기
- 동시 요청 피하기
- 웹훅 구독 (폴링 대신)
- 감사 로그 스트리밍으로 문제 해결

## 노드 제한

스키마 유효성 검사 요구사항:

- 모든 연결에 `first` 또는 `last` 인수 필수
- 값 범위: 1~100
- 단일 호출: 500,000개 노드 초과 불가

## 시간 제한

- 처리 시간 10초 초과 시 요청 종료
- "응답 시간 초과" 메시지 반환
- 다음 시간 기본 제한에서 추가 포인트 차감

## 기타 리소스 제한

과다한 리소스 사용 시:
- 요청 중단
- 부분 결과 + 오류 반환

**주의 사항**:
- 수천 개 개체 또는 깊게 중첩된 관계 요청
- 여러 연결에서 큰 `first`/`last` 값 동시 사용
- 광범위한 세부정보 조회

## 최적화 전략

1. **개체 수 제한**: 작은 값으로 설정, 페이지네이션 활용
2. **쿼리 깊이 감소**: 깊은 중첩 피하기
3. **결과 필터링**: 필요한 데이터만 반환
4. **대규모 쿼리 분할**: 복잡한 쿼리를 여러 단순 쿼리로 분할
5. **필드 선택**: 필요한 필드만 요청
