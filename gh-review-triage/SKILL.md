---
name: gh-review-triage
description: GitHub Pull Request 링크를 입력받아 리뷰 코멘트(라인 코멘트/리뷰 코멘트/일반 코멘트)를 수집하고, 각 코멘트의 반영 여부를 판단한다. 판단 근거를 설명하고 반영이 필요한 항목은 구체적인 수정 방법과 검증 방법까지 제시할 때 사용한다.
---

# GH Review Triage

PR 리뷰 코멘트를 실행 가능한 액션으로 분류하는 작업용 스킬이다.

핵심 원칙:

1. 코멘트 요약보다 판단 근거를 우선 제공한다.
2. `반영` 판단이면 반드시 어떻게 반영할지까지 제시한다.
3. 코드베이스/컨벤션/테스트 맥락과 충돌하는 의견은 무비판 수용하지 않는다.
4. 정보가 부족하면 추측하지 말고 `판단 보류`로 분리한다.

## 사용법

- 호출 예시: `/gh-review-triage https://github.com/org/repo/pull/123`
- `$ARGUMENTS`가 없으면 PR 링크를 요청하고 중단한다.
- 지원 URL:
  - `https://github.com/{owner}/{repo}/pull/{number}`
  - `http://github.com/{owner}/{repo}/pull/{number}`

## 실행 워크플로우

### 1단계: 입력/접근성 확인

1. `$ARGUMENTS`에서 PR URL을 추출한다.
2. URL 패턴이 맞지 않으면 올바른 예시를 제시하고 중단한다.
3. URL에서 `OWNER`, `REPO`, `PR_NUMBER`를 추출한다.
4. `gh` 인증/권한을 점검한다.
   - 실패 시 `gh auth status` 결과와 함께 접근 권한 문제를 안내하고 중단한다.

### 2단계: 리뷰 코멘트 수집

아래 데이터를 수집한다.

1. PR 메타 및 변경 파일

```bash
gh pr view "$PR_URL" --json number,title,baseRefName,headRefName,author,files,reviews,comments
```

2. 인라인 리뷰 코멘트

```bash
gh api "repos/$OWNER/$REPO/pulls/$PR_NUMBER/comments?per_page=100" --paginate
```

3. PR 일반 코멘트(이슈 코멘트)

```bash
gh api "repos/$OWNER/$REPO/issues/$PR_NUMBER/comments?per_page=100" --paginate
```

중복 코멘트(동일 작성자 + 동일 본문 + 동일 시각)는 제거한다.

### 3단계: 코멘트 정규화

각 코멘트를 아래 구조로 정리한다.

- `id`
- `type` (`INLINE_REVIEW`, `PR_REVIEW`, `GENERAL`)
- `reviewer`
- `file:line` (있으면)
- `body`
- `created_at`

코멘트가 0개면 "리뷰 코멘트 없음"으로 보고하고 종료한다.

### 4단계: 반영 여부 판단

각 코멘트마다 반드시 `반영` 또는 `미반영`을 결정한다.
근거가 부족하면 `미반영(판단 보류)`로 표기하고 필요한 확인사항을 함께 적는다.

판단 기준:

- 반영
  - 기능/정합성/버그/보안/데이터 무결성 문제를 지적한다.
  - 성능/동시성/장애 가능성 등 운영 리스크를 실질적으로 낮춘다.
  - 테스트 누락/회귀 방지 관점에서 타당하다.
  - 프로젝트 컨벤션/아키텍처와 일치한다.

- 미반영
  - 개인 취향 수준의 스타일 제안이고 기존 컨벤션과 충돌한다.
  - 사실관계가 틀렸거나 현재 코드 전제와 맞지 않는다.
  - 적용 시 부작용이 이득보다 크다.
  - 이미 다른 변경으로 해결되었다.

### 5단계: 반영 방법 제시 (반영 항목 필수)

`반영`으로 판단한 코멘트는 아래를 반드시 포함한다.

1. 수정 대상 (`파일/함수/모듈`)
2. 변경 방향 (무엇을 어떻게 바꿀지)
3. 검증 방법 (최소 1개 테스트 또는 수동 검증 시나리오)
4. 필요 시 간단한 코드 스케치/의사코드

### 6단계: 최종 보고 형식

아래 포맷으로 답변한다.

```markdown
## PR 리뷰 코멘트 판정

### 코멘트 {번호}
- 코멘트: {원문 요약}
- 위치: {file:line 또는 N/A}
- 판단: 반영 / 미반영
- 근거:
  - {근거 1}
  - {근거 2}

- 반영 방법: (반영일 때만)
  - 대상: {파일/함수}
  - 변경: {구체 변경}
  - 검증: {테스트/검증 방법}

### 코멘트 {번호}
...

## 종합
- 반영: {n}건
- 미반영: {n}건
- 판단 보류: {n}건 (필요 정보: {요약})
```

## 승인 게이트

아래 상황이면 사용자 확인을 받고 다음 단계로 진행한다.

- 코멘트 반영을 위해 요청 범위를 넘는 리팩토링이 필요한 경우
- 다수 코멘트가 서로 충돌하여 선택이 필요한 경우
- 현재 로컬 코드와 PR HEAD가 달라 정확한 판단이 어려운 경우

승인 요청 템플릿:

```markdown
[승인 필요]
- 상황: {요약}
- 충돌/제약: {이유}
- 옵션 A: {보수적 대응}
- 옵션 B: {근본 대응}
- 권장안: {A/B + 이유}
```

## 금지 사항

- 근거 없이 "느낌상 반영"으로 판단
- `반영` 판단인데 구체적인 변경 방법/검증 계획을 누락
- 리뷰어 권위만으로 무비판 수용
